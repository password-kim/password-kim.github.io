---
layout: single
title: "#02_ìœ í•œìƒíƒœê¸°ê³„ - FSM01"
categories: C#_In_Unity
tag: [C#, Unity, FSM]
---



# ğŸ“œFSM?

---

- ì£¼ì–´ì§€ëŠ” ëª¨ë“  ì‹œê°„ì—ì„œ ì²˜í•´ ìˆì„ ìˆ˜ ìˆëŠ” ìœ í•œ ê°œì˜ ìƒíƒœë¥¼ ê°€ì§€ê³  ì£¼ì–´ì§€ëŠ” ì…ë ¥ì— ë”°ë¼ ì–´ë–¤ ìƒíƒœì—ì„œ ë‹¤ë¥¸ ìƒíƒœë¡œ ì „í™˜ì‹œí‚¤ê±°ë‚˜ ì¶œë ¥ì´ë‚˜ ì•¡ì…˜ì´ ì¼ì–´ë‚˜ê²Œ í•˜ëŠ” ì¥ì¹˜ ë˜ëŠ” ê·¸ëŸ° ì¥ì¹˜ë¥¼ ë‚˜íƒ€ë‚¸ ëª¨ë¸.
- ê°ì²´ì˜ í–‰ë™ì„ ê°ê°ì˜ ìƒíƒœ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ ê´€ë¦¬í•˜ëŠ” ê²ƒ.

> ***í”Œë ˆì´ì–´, ì , NPCì™€ ê°™ì€ ìºë¦­í„°ì˜ í–‰ë™ì„ â€œëŒ€ê¸°â€, â€œê±·ê¸°â€, â€œê·¼ì ‘ ê³µê²©â€ê³¼ ê°™ì´ ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ìƒíƒœ ë‹¨ìœ„ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒ.***

<br/>

# ğŸ“œFSMì˜ ì¥ì .

---

> ***ì‰¬ìš´ êµ¬í˜„***
> 

â‡’ í–‰ë™ ë‹¨ìœ„ë¡œ ë¶„í• ëœ êµ¬ì¡°ë¥¼ ê°€ì§€ê¸° ë•Œë¬¸ì— êµ¬ì¡°ë¥¼ ì•Œì•„ë³´ê¸° ì‰½ê³ , êµ¬í˜„ì´ ì‰½ë‹¤.

<br/>

> ***ì˜¤ë¥˜ìˆ˜ì • ìš©ì´***

â‡’ ê²Œì„ ì˜¤ë¸Œì íŠ¸ì˜ í–‰ë™ì„ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” í´ë˜ìŠ¤ ë‹¨ìœ„ë¡œ ë¶„í•  í•˜ê¸° ë•Œë¬¸ì— ê²Œì„ ì˜¤ë¸Œì íŠ¸ì˜ ë™ì‘ì´ ì´ìƒí•˜ë©´ í•´ë‹¹ ë™ì‘ì˜ í´ë˜ìŠ¤ì—ì„œ ì˜¤ë¥˜ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì˜¤ë¥˜ ìˆ˜ì •ì´ ìš©ì´í•˜ë‹¤.

<br/>

> ***ìœ ì—°í•œ ì½”ë“œ***

â‡’ ìƒˆë¡œìš´ ìƒíƒœë“¤ê³¼ ê·œì¹™ë“¤ì„ ì¶”ê°€í•¨ìœ¼ë¡œì¨ ê²Œì„ ì˜¤ë¸Œì íŠ¸ í–‰ë™ ë²”ìœ„ë¥¼ ê°„ë‹¨í•˜ê²Œ í™•ì¥ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

<br/>

> ***ì§ê´€ì ì¸ ì½”ë“œ***

â‡’ ê²Œì„ ì˜¤ë¸Œì íŠ¸ì˜ í–‰ë™ì„ ì—¬ëŸ¬ê°œì˜ ìƒíƒœë“¤ë¡œ ë¶„í•´í•˜ê³ , ì´ ìƒíƒœë¥¼ ì „í™˜í•˜ëŠ”ë° ìš”êµ¬ë˜ëŠ” ê·œì¹™ë“¤ì„ ë‚˜ì—´í•˜ê¸° ë•Œë¬¸ì— í•´ë‹¹ ê²Œì„ ì˜¤ë¸Œì íŠ¸ê°€ ê°€ì§€ê³  ìˆëŠ” ìƒíƒœì™€ ìƒíƒœ ë³€í™”ë¥¼ ì§ê´€ì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë‹¤.

<br/>

# ğŸ“œê²Œì„ì—ì„œì˜ FSM

---

- í”Œë ˆì´ì–´, ì , NPCì™€ ê°™ì€ ê°œì¸ ë‹¨ìœ„ì˜ í–‰ë™ ê´€ë¦¬.
    - ì§€ì •ëœ ìœ„ì¹˜ë¡œ ì´ë™í•˜ê¸°,  íƒ€ê²Ÿì„ ê³µê²©í•˜ê¸°, ë„ë§ê°€ê¸°, í˜‘ê³µí•˜ê¸° ë“±.

- ìŠ¤í¬ì¸ , RTS ë“±ì˜ ì¥ë¥´ì™€ ê°™ì´ ì—¬ëŸ¬ ìºë¦­í„°ë¥¼ í•œêº¼ë²ˆì— ë‹¤ë£° ë•Œ ë‹¨ì²´ í–‰ë™ ê´€ë¦¬.

- ìœ ë‹ˆí‹°ì˜ ì”¬ ë‹¨ìœ„ ê´€ë¦¬.
    - Lobby, Town, Stage01, Stage02, GameClear, GameOver ìƒíƒœ ë“±.
        - í•´ë‹¹ ìƒíƒœ(ì”¬)ë¥¼ ì‹œì‘í•  ë•Œ 1íšŒ â‡’ ëª¨ë“  ê²Œì„ ì˜¤ë¸Œì íŠ¸/ ì»´í¬ë„ŒíŠ¸ ë©”ëª¨ë¦¬ í• ë‹¹.
        - í•´ë‹¹ ìƒíƒœ(ì”¬)ë¥¼ ì—…ë°ì´íŠ¸í•  ë•Œ ë§¤ í”„ë ˆì„ ì”¬ â‡’ ì”¬ êµ¬ë™, ì”¬ ë‚´ì˜ ì˜¤ë¸Œì íŠ¸ë“¤ì´ ê°ìì˜ ì—­í• ì„ í•¨.
        - í•´ë‹¹ ìƒíƒœ(ì”¬)ë¥¼ ë¹ ì ¸ë‚˜ê°ˆ ë•Œ 1íšŒ â‡’ ëª¨ë“  ê²Œì„ ì˜¤ë¸Œì íŠ¸/ì»´í¬ë„ŒíŠ¸ ë©”ëª¨ë¦¬ í•´ì œ.

- ìœ ë‹ˆí‹°ì˜ ë©”ì¹´ë‹˜ ì• ë‹ˆë©”ì´ì…˜ ì‹œìŠ¤í…œ.

    <br/>

# ğŸ“œSimple FSM

---

ì‚¬ì‹¤ FSMì„ ëª¨ë¥´ëŠ” ì‚¬ëŒë„ ì•Œê²Œëª¨ë¥´ê²Œ ê°„ë‹¨í•œ FSMì„ ì‚¬ìš©í•˜ê³  ìˆì—ˆë‹¤. ë°”ë¡œ if-then / switch-case ë¬¸ìœ¼ë¡œ êµ¬ì„±ëœ FSMì´ë‹¤. 

ê°„ë‹¨í•œ ì˜ˆë¡œ ì…ë ¥ì— ë”°ë¼ í”Œë ˆì´ì–´ì˜ ìƒíƒœë¥¼ ë³€í™˜í•˜ëŠ” ì½”ë“œê°€ ìˆë‹¤ê³  ìƒê°í•´ë³´ì.

```csharp
using UnityEngine;

public enum PlayerState
{
    Idle,
    walk,
    Run,
    Attack
}

public class PlayerController : MonoBehaviour
{
    private PlayerState _playerState;

    void Awake()
    {
        ChangeState(PlayerState.Idle);
    }

    void Update()
    {
        // 1 ~ 4 ìˆ«ìí‚¤ë¥¼ ëˆŒëŸ¬ ìƒíƒœ ë³€ê²½
        if (Input.GetKeyDown("1")) ChangeState(PlayerState.Idle);
        else if (Input.GetKeyDown("2")) ChangeState(PlayerState.walk);
        else if (Input.GetKeyDown("3")) ChangeState(PlayerState.Run);
        else if (Input.GetKeyDown("4")) ChangeState(PlayerState.Attack);

        UpdateState();
    }

    /// <summary>
    /// _playerStateì— ë”°ë¼ í˜„ì¬ í”Œë ˆì´ì–´ì˜ í–‰ë™ì„ ì‹¤í–‰í•œë‹¤.
    /// </summary>
    private void UpdateState()
    {
        if (_playerState == PlayerState.Idle)
        {
            Debug.Log("í”Œë ˆì´ì–´ê°€ ì œìë¦¬ì—ì„œ ëŒ€ê¸°ì¤‘ì…ë‹ˆë‹¤.");
        }
        else if (_playerState == PlayerState.walk)
        {
            Debug.Log("í”Œë ˆì´ì–´ê°€ ê±¸ì–´ê°‘ë‹ˆë‹¤.");
        }
        else if (_playerState == PlayerState.Run)
        {
            Debug.Log("í”Œë ˆì´ì–´ê°€ ë›°ì–´ê°‘ë‹ˆë‹¤.");
        }
        else if (_playerState == PlayerState.Attack)
        {
            Debug.Log("í”Œë ˆì–´ê°€ ëª©í‘œë¥¼ ê³µê²©í•©ë‹ˆë‹¤.");
        }
    }

    /// <summary>
    /// í”Œë ˆì´ì–´ì˜ í–‰ë™ì„ newStateë¡œ ë³€ê²½í•œë‹¤.
    /// </summary>
    private void ChangeState(PlayerState newState)
    {
        _playerState = newState;
    }
}
```

ì–¸ëœ» ë³´ê¸°ì—” ê´œì°®ì€ ì ‘ê·¼ë°©ì‹ì²˜ëŸ¼ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ ì´ëŸ¬í•œ êµ¬ì¡°ëŠ” ìƒíƒœê°€ ë§ì•„ì§€ê³  ì¡°ê±´ì´ ë‹¤ì–‘í•´ì§ˆ ìˆ˜ë¡ ì½”ë“œì˜ ë³µì¡ì„±ì´ ì»¤ì§€ê²Œ ëœë‹¤. ë˜í•œ ì´ëŸ¬í•œ ë°©ë²•ì€ ìœ ì—°ì„±ë„ ì—†ê³ , ì´ˆê¸°ì— ë””ìì¸í•œ ë²”ìœ„ ì´ìƒìœ¼ë¡œ í™•ì¥í•˜ëŠ” ê²ƒì´ ì‰½ì§€ ì•Šë‹¤. ë§Œì•½ ë§¤ìš° ë‹¨ìˆœí•œ í–‰ë™ì„ êµ¬í˜„í•˜ê¸° ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë¼ë©´ ì´ëŸ¬í•œ êµ¬ì¡°ëŠ” í”¼í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

<br/>

> ***ë˜í•œ ìƒíƒœì— ì§„ì…í•  ë•Œ, ë¹ ì ¸ë‚˜ì˜¬ ë•Œ ì–´ë– í•œ í–‰ë™ì„ ì·¨í•´ì¤˜ì•¼ í•œë‹¤ë©´ êµ¬ì¡°ëŠ” ë” ë³µì¡í•´ì§„ë‹¤.***
> 

```csharp
using UnityEngine;

public enum PlayerState
{
    Idle,
    walk,
    Run,
    Attack
}

public class PlayerController : MonoBehaviour
{
    private PlayerState _playerState;

    // ìƒíƒœê°€ ë°”ë€” ë•Œ trueê°€ ë˜ì–´ ìƒíƒœ ì—…í…Œì´íŠ¸ ë‚´ë¶€ì—ì„œ 1íšŒë§Œ ì‹¤í–‰ë˜ëŠ” ë‚´ìš©ì„ ì‹¤í–‰í•˜ê³  falseë¡œ ë³€ê²½.
    private bool _isChanged = false;

    void Awake() ...
    void Update() ...

    /// <summary>
    /// _playerStateì— ë”°ë¼ í˜„ì¬ í”Œë ˆì´ì–´ì˜ í–‰ë™ì„ ì‹¤í–‰í•œë‹¤.
    /// </summary>
    private void UpdateState()
    {
        if (_playerState == PlayerState.Idle)
        {
            if (_isChanged)
            {
                Debug.Log("ë¹„ì „íˆ¬ ìƒíƒœë¡œ ì§„ì…í•©ë‹ˆë‹¤.");
                Debug.Log("ì´ˆë‹¹ 10ì”© HP/MP íšŒë³µ");
                _isChanged = false;
            }
            Debug.Log("í”Œë ˆì´ì–´ê°€ ì œìë¦¬ì—ì„œ ëŒ€ê¸°ì¤‘ì…ë‹ˆë‹¤.");
        }
        else if (_playerState == PlayerState.walk)
        {
            if (_isChanged)
            {
                Debug.Log("ì´ë™ì†ë„ë¥¼ 2ë¡œ ì„¤ì •.");
                _isChanged = false;
            }
            Debug.Log("í”Œë ˆì´ì–´ê°€ ê±¸ì–´ê°‘ë‹ˆë‹¤.");
        }
        else if (_playerState == PlayerState.Run)
        {
            if (_isChanged)
            {
                Debug.Log("ì´ë™ì†ë„ë¥¼ 5ë¡œ ì„¤ì •.");
                _isChanged = false;
            }
            Debug.Log("í”Œë ˆì´ì–´ê°€ ë›°ì–´ê°‘ë‹ˆë‹¤.");
        }
        else if (_playerState == PlayerState.Attack)
        {
            if (_isChanged)
            {
                Debug.Log("ì „íˆ¬ëª¨ë“œë¡œ ë³€ê²½í•©ë‹ˆë‹¤.");
                Debug.Log("HP/MP ìë™ íšŒë³µ ì¤‘ì§€.");
                _isChanged = false;
            }
            Debug.Log("í”Œë ˆì–´ê°€ ëª©í‘œë¥¼ ê³µê²©í•©ë‹ˆë‹¤.");
        }
    }

    /// <summary>
    /// í”Œë ˆì´ì–´ì˜ í–‰ë™ì„ newStateë¡œ ë³€ê²½í•œë‹¤.
    /// </summary>
    private void ChangeState(PlayerState newState)
    {
        _playerState = newState;
        _isChanged = true;
    }
}
```

<br/>

## ğŸ–Šï¸Coroutine ì ìš©

---

ì´ë•Œ ìœ ë‹ˆí‹°ì—ì„œ ì œê³µí•˜ëŠ” Coroutineì„ í™œìš©í•˜ë©´ ì¢€ ë” ì‰¬ìš´ í‘œí˜„ì´ ê°€ëŠ¥í•˜ë‹¤.

```csharp
private IEnumerator Idle()
{
    // ìƒíƒœë¡œ ì§„ì…í•  ë•Œ 1íšŒ í˜¸ì¶œí•˜ëŠ” ë‚´ìš©.
    Debug.Log("ë¹„ì „íˆ¬ ìƒíƒœë¡œ ì§„ì…í•©ë‹ˆë‹¤.");
    Debug.Log("ì´ˆë‹¹ 10ì”© HP/MP íšŒë³µ");

    // ìƒíƒœê°€ ì—…ë°ì´íŠ¸ ë˜ëŠ” ë™ì•ˆ ë§¤ í”„ë ˆì„ í˜¸ì¶œí•˜ëŠ” ë‚´ìš©.
    while (true)
    {
        Debug.Log("í”Œë ˆì´ì–´ê°€ ì œìë¦¬ì—ì„œ ëŒ€ê¸°ì¤‘ì…ë‹ˆë‹¤.");
        yield return null;
    }

    // ìƒíƒœê°€ ì¢…ë£Œë  ë•Œ í˜¸ì¶œí•˜ëŠ” ë‚´ìš©.
    // TODO
 }
```

<br/>

ë˜í•œ ìƒíƒœì— ë”°ë¼ í–‰ë™ì„ ì‹¤í–‰í•´ì£¼ë˜ StateUpdate()í•¨ìˆ˜ë„ í•„ìš”ì—†ê²Œ ë˜ì—ˆë‹¤. 

```csharp
using System.Collections;
using UnityEngine;

public enum PlayerState
{
    Idle,
    Walk,
    Run,
    Attack
}

public class PlayerController : MonoBehaviour
{
    private PlayerState _playerState = PlayerState.Idle;
		
		// ê°ê°€ì˜ ìƒíƒœì— ëŒ€í•œ Coroutineí•¨ìˆ˜ë¥¼ ì €ì¥í•  ë³€ìˆ˜.
    private IEnumerator _idleCoroutine;
    private IEnumerator _walkCoroutine;
    private IEnumerator _runCoroutine;
    private IEnumerator _attackCoroutine;

    void Awake()
    {
				// ê°ê°ì˜ Stateì— ë§ëŠ” Coroutineí•¨ìˆ˜ í• ë‹¹.
        _idleCoroutine = Idle();
        _walkCoroutine = Walk();
        _runCoroutine = Run();
        _attackCoroutine = Attack();
        ChangeState(PlayerState.Idle);
    }
    
    void Update()
    {
        // 1 ~ 4 ìˆ«ìí‚¤ë¥¼ ëˆŒëŸ¬ ìƒíƒœ ë³€ê²½
        if (Input.GetKeyDown("1")) ChangeState(PlayerState.Idle);
        else if (Input.GetKeyDown("2")) ChangeState(PlayerState.Walk);
        else if (Input.GetKeyDown("3")) ChangeState(PlayerState.Run);
        else if (Input.GetKeyDown("4")) ChangeState(PlayerState.Attack);
    }

    /// <summary>
    /// í”Œë ˆì´ì–´ì˜ ìƒíƒœë¥¼ newStateë¡œ ë³€ê²½í•œë‹¤.
    /// </summary>
    /// <param name="newState">ë³€ê²½í•  PlayerState</param>
    private void ChangeState(PlayerState newState)
    {
        // ì´ì „ ìƒíƒœì˜ ì½”ë£¨í‹´ ì¢…ë£Œ.
        switch (_playerState)
        {
            case PlayerState.Idle:
                StopCoroutine(_idleCoroutine);
                break;
            case PlayerState.Walk:
                StopCoroutine(_walkCoroutine);
                break;
            case PlayerState.Run:
                StopCoroutine(_runCoroutine);
                break;
            case PlayerState.Attack:
                StopCoroutine(_attackCoroutine);
                break;
        }

        // í˜„ì¬ ìƒíƒœë¥¼ newStateë¡œ ë³€ê²½.
        _playerState = newState;

        // í˜„ì¬ ìƒíƒœì˜ ì½”ë£¨í‹´ ì‹¤í–‰.
        switch (newState)
        {
            case PlayerState.Idle:
                StartCoroutine(_idleCoroutine);
                break;
            case PlayerState.Walk:
                StartCoroutine(_walkCoroutine);
                break;
            case PlayerState.Run:
                StartCoroutine(_runCoroutine);
                break;
            case PlayerState.Attack:
                StartCoroutine(_attackCoroutine);
                break;
        }
    }

    private IEnumerator Idle() ...

    private IEnumerator Walk() ...

    private IEnumerator Run() ...

    private IEnumerator Attack() ...
    
}
```

<br/>

# ğŸ“œë” ë‚˜ì€ FSM

---

- ì—ì´ì „íŠ¸ì™€ ìƒíƒœì˜ ë¶„ë¦¬
    - ê° ìƒíƒœë¥¼ ì—ì´ì „íŠ¸ ë‚´ë¶€(í´ë˜ìŠ¤)ì— ì‘ì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ì—ì´ì „íŠ¸ ì™¸ë¶€ì— ì¡´ì¬í•˜ëŠ” **ë³„ê°œì˜ í´ë˜ìŠ¤ë¡œ ì‘ì„±.**
    - **ë” ëª…í™•í•˜ê³  ìœ ì—°í•œ êµ¬ì¡°**ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©°, ì•ì— ë‚˜ì™”ë˜ if-then / switch êµ¬ì¡°ë³´ë‹¤ ìŠ¤íŒŒê²Œí‹°í™” ë  ê°€ëŠ¥ì„±ì´ í›¨ì”¬ ì ë‹¤.
    - ë™ì¼í•œ ìƒíƒœë¥¼ ì´ìš©í•˜ëŠ” ë‹¤ë¥¸ ì—ì´ì „íŠ¸ê°€ ìˆì„ ê²½ìš° **ì½”ë“œì˜ ì¬ì‚¬ìš©**ì„ ì¤„ì—¬ì¤€ë‹¤.
- ë‚´ì¥ëœ ê·œì¹™ë“¤
    - **ê° ìƒíƒœë“¤ ìì‹ ì˜ ë‚´ë¶€ì— ìƒíƒœ ì „í™˜ì„ ìœ„í•œ ê·œì¹™**ë“¤ì„ ë‚´ì¥ì‹œí‚¤ëŠ” ë°©ë²•ì´ë‹¤.
    - ê° ìƒíƒœëŠ” ë‹¤ë¥¸ ìƒíƒœë„ ì¡´ì¬í•˜ê³  ìˆìŒì„ ì•Œê³  ìˆì§€ë§Œ, ìì‹ ì˜ ìƒíƒœë¥¼ ë‹¤ë¥¸ ìƒíƒœë¡œ ë³€ê²½í• ì§€ë¥¼  ì™¸ë¶€ ë…¼ë¦¬ê°€ ì•„ë‹Œ **ìê¸° ìŠ¤ìŠ¤ë¡œ íŒë‹¨í•˜ì—¬ êµì²´**í•œë‹¤.
    - ìƒíƒœë“¤ì€ **ê°ì²´ë¡œ ìº¡ìŠí™”**ë˜ì–´ ìˆê³  ìƒíƒœ ì „í™˜ì„ ì‰½ê²Œ í•˜ëŠ”ë° ìš”êµ¬ë˜ëŠ” **ë…¼ë¦¬ë“¤ì„ í¬í•¨**í•˜ê³  ìˆë‹¤.
    - ë˜í•œ, ëª¨ë“  ìƒíƒœ ê°ì²´ë“¤ì€ **ê³µí†µì˜ ê¸°ë°˜ í´ë˜ìŠ¤ë¥¼ ê³µìœ **í•œë‹¤.
    
    <br/>

# ğŸ“œë‹¨ê³„ë³„ FSM

- 1ë‹¨ê³„ : if-then / switch - caseë¥¼ ì´ìš©í•œ ì•„ì£¼ ë‹¨ìˆœí•œ FSM êµ¬í˜„.
- 2ë‹¨ê³„ : í•˜ë‚˜ì˜ ì—ì´ì „íŠ¸ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” FSM êµ¬í˜„.
- 3ë‹¨ê³„: ì—¬ëŸ¬ ì—ì´ì „íŠ¸ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” FSM êµ¬í˜„.
- 4ë‹¨ê³„ : ì—ì´ì „íŠ¸ë“¤ ê°„ì˜ ì†Œí†µì„ ìœ„í•œ ì •ë³´ ì „ë‹¬ ì‹œìŠ¤í…œ.

<br/>

# ğŸ“œì°¸ê³ ìë£Œ

---

[ê³ ë°•ì‚¬ì˜ ìœ ë‹ˆí‹° ë…¸íŠ¸ - How to make a FSM in Unityì‹œë¦¬ì¦ˆ](https://www.youtube.com/watch?v=O_NJaHpbjaI&t=456s)